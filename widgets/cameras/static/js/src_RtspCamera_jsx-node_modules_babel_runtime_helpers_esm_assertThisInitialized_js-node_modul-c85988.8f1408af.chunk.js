/*! For license information please see src_RtspCamera_jsx-node_modules_babel_runtime_helpers_esm_assertThisInitialized_js-node_modul-c85988.8f1408af.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkiobroker_vis_2_widgets_camera=self.webpackChunkiobroker_vis_2_widgets_camera||[]).push([["src_RtspCamera_jsx-node_modules_babel_runtime_helpers_esm_assertThisInitialized_js-node_modul-c85988"],{52665:function(t,e,n){var r=n(15671),a=n(43144),i=n(60136),o=n(27277),c=n(15854),u=n.n(c),s=n(88411),l=function(t){(0,i.Z)(n,t);var e=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),e.apply(this,arguments)}return(0,a.Z)(n,null,[{key:"getI18nPrefix",value:function(){return"cameras_"}}]),n}(window.visRxWidget||s.VisRxWidget);l.propTypes={context:u().object,themeType:u().string,style:u().object,data:u().object},e.Z=l},57003:function(t,e,n){n.r(e);var r=n(15671),a=n(43144),i=n(11752),o=n(61120),c=n(60136),u=n(27277),s=n(74165),l=n(15861),f=n(29439),d=n(4819),p=n.n(d),m=n(94427),h=n(58503),v=n(21668),y=n(52665),b=n(80184),g=function(t){var e=p().useState([]),n=(0,f.Z)(e,2),r=n[0],a=n[1];return(0,d.useEffect)((function(){(0,l.Z)((0,s.Z)().mark((function e(){var n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],e.next=3,t.context.socket.getAdapterInstances("cameras");case 3:e.sent.forEach((function(t){var e=t._id.split(".").pop();t.native.cameras.filter((function(t){return"rtsp"===t.type})).forEach((function(t){n.push({instanceId:e,name:t.name,ip:t.ip,desc:t.desc})}))})),a(n);case 6:case"end":return e.stop()}}),e)})))()}),[]),(0,b.jsx)(m.Select,{fullWidth:!0,variant:"standard",value:t.data.camera||"",onChange:function(e){return t.setData({camera:e.target.value})},children:r.map((function(t){return(0,b.jsxs)(m.MenuItem,{value:t,children:[(0,b.jsx)("div",{children:"cameras.".concat(t.instanceId,".").concat(t.name)}),(0,b.jsx)("div",{style:{fontSize:10,fontStyle:"italic",opacity:.7},children:"".concat(t.desc,"/").concat(t.ip)})]},t.name)}))})},Z=function(t){(0,c.Z)(n,t);var e=(0,u.Z)(n);function n(t){var a;return(0,r.Z)(this,n),(a=e.call(this,t)).videoInterval=null,a.videoRef=p().createRef(),a.currentCam=null,a}return(0,a.Z)(n,[{key:"getWidgetInfo",value:function(){return n.getWidgetInfo()}},{key:"propertiesUpdate",value:function(){var t=(0,l.Z)((0,s.Z)().mark((function t(){var e,n,r,a,i,o;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.state.rxData.camera){t.next=7;break}return t.next=3,this.props.context.socket.sendTo("cameras.".concat(null===(e=this.state.rxData.camera)||void 0===e?void 0:e.instanceId),"webStreaming",{camera:null===(n=this.state.rxData.camera)||void 0===n?void 0:n.name});case 3:r=t.sent,v.Z.isSupported()&&JSON.stringify(this.state.rxData.camera)!==JSON.stringify(this.currentCam)&&(null!==(a=this.currentCam)&&void 0!==a&&a.name&&this.props.context.socket.sendTo("cameras.".concat(this.currentCam.instanceId),"stopWebStreaming",{camera:this.currentCam.name}),this.currentCam=JSON.stringify(this.state.rxData.camera),i=this.videoRef.current,(o=new v.Z).attachMedia(i),o.on(v.Z.Events.MEDIA_ATTACHED,(function(){console.log("video and hls.js are now bound together! Loading ".concat(r.url)),o.loadSource("../".concat(r.url))}))),t.next=9;break;case 7:this.videoRef.current.src="",this.currentCam&&(this.currentCam.name&&this.props.context.socket.sendTo("cameras.".concat(this.currentCam.instanceId),"stopWebStreaming",{camera:this.currentCam.name}),this.currentCam=null);case 9:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){var t=(0,l.Z)((0,s.Z)().mark((function t(){var e=this;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(0,i.Z)((0,o.Z)(n.prototype),"componentDidMount",this).call(this),this.videoInterval=setInterval((0,l.Z)((0,s.Z)().mark((function t(){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.propertiesUpdate();case 1:case"end":return t.stop()}}),t)}))),2e4),t.next=4,this.propertiesUpdate();case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"onRxDataChanged",value:function(){var t=(0,l.Z)((0,s.Z)().mark((function t(){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.propertiesUpdate();case 2:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){(0,i.Z)((0,o.Z)(n.prototype),"componentWillUnmount",this).call(this),this.videoInterval&&clearInterval(this.videoInterval),this.videoInterval=null,this.videoRef.current&&(this.videoRef.current.src=""),this.currentCam&&(this.currentCam.name&&this.props.context.socket.sendTo("cameras.".concat(this.currentCam.instanceId),"stopWebStreaming",{camera:this.currentCam.name}),this.currentCam=null)}},{key:"renderWidgetBody",value:function(t){(0,i.Z)((0,o.Z)(n.prototype),"renderWidgetBody",this).call(this,t);var e=(0,b.jsx)("div",{className:this.props.classes.imageContainer,children:(0,b.jsx)("video",{id:"video",autoPlay:!0,controls:"controls",type:"application/x-mpegURL",ref:this.videoRef,className:this.props.classes.camera,onPlay:function(){},onPause:function(){},children:"Your browser does not support the video tag."})});return this.state.rxData.noCard||t.widget.usedInWidget?e:this.wrapContent(e,null,{boxSizing:"border-box",paddingBottom:10,height:"100%"},null,null,{Card:m.Card,CardContent:m.CardContent})}}],[{key:"getWidgetInfo",value:function(){return{id:"tplCameras2RtspCamera",visSet:"vis-2-widgets-cameras",visName:"RTSP Camera",visWidgetLabel:"RTSP Camera",visWidgetSetLabel:"Cameras",visSetLabel:"Cameras",visSetColor:"#9f0026",visAttrs:[{name:"common",fields:[{name:"noCard",label:"without_card",type:"checkbox"},{name:"widgetTitle",label:"name",hidden:"!!data.noCard"},{label:"Camera",name:"camera",type:"custom",component:function(t,e,n,r){return(0,b.jsx)(g,{field:t,data:e,setData:n,context:r.context})}}]}],visDefaultStyle:{width:"100%",height:240,position:"relative"},visPrev:"widgets/cameras/img/prev_camera.png"}}}]),n}(y.Z);e.default=(0,h.withStyles)((function(){return{camera:{width:"100%",height:"100%",objectFit:"contain",cursor:"pointer"},time:{textAlign:"right",width:"100%",paddingTop:20,fontSize:12,opacity:.8,fontStyle:"italic",position:"absolute",bottom:3,right:3},imageContainer:{flex:1,overflow:"hidden",position:"relative",width:"100%",height:"100%"}}}))(Z)},66374:function(t,e,n){var r=n(4819),a=Symbol.for("react.element"),i=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,c=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function s(t,e,n){var r,i={},s=null,l=null;for(r in void 0!==n&&(s=""+n),void 0!==e.key&&(s=""+e.key),void 0!==e.ref&&(l=e.ref),e)o.call(e,r)&&!u.hasOwnProperty(r)&&(i[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps)void 0===i[r]&&(i[r]=e[r]);return{$$typeof:a,type:t,key:s,ref:l,props:i,_owner:c.current}}e.Fragment=i,e.jsx=s,e.jsxs=s},80184:function(t,e,n){t.exports=n(66374)},30907:function(t,e,n){function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}n.d(e,{Z:function(){return r}})},83878:function(t,e,n){function r(t){if(Array.isArray(t))return t}n.d(e,{Z:function(){return r}})},97326:function(t,e,n){function r(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}n.d(e,{Z:function(){return r}})},15671:function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,{Z:function(){return r}})},43144:function(t,e,n){n.d(e,{Z:function(){return i}});var r=n(49142);function a(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,(0,r.Z)(a.key),a)}}function i(t,e,n){return e&&a(t.prototype,e),n&&a(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}},4942:function(t,e,n){n.d(e,{Z:function(){return a}});var r=n(49142);function a(t,e,n){return(e=(0,r.Z)(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}},59199:function(t,e,n){function r(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}n.d(e,{Z:function(){return r}})},25267:function(t,e,n){function r(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}n.d(e,{Z:function(){return r}})},89611:function(t,e,n){function r(t,e){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},r(t,e)}n.d(e,{Z:function(){return r}})},29439:function(t,e,n){n.d(e,{Z:function(){return o}});var r=n(83878);var a=n(40181),i=n(25267);function o(t,e){return(0,r.Z)(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,a,i,o,c=[],u=!0,s=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(c.push(r.value),c.length!==e);u=!0);}catch(l){s=!0,a=l}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(s)throw a}}return c}}(t,e)||(0,a.Z)(t,e)||(0,i.Z)()}},93433:function(t,e,n){n.d(e,{Z:function(){return o}});var r=n(30907);var a=n(59199),i=n(40181);function o(t){return function(t){if(Array.isArray(t))return(0,r.Z)(t)}(t)||(0,a.Z)(t)||(0,i.Z)(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},49142:function(t,e,n){n.d(e,{Z:function(){return a}});var r=n(71002);function a(t){var e=function(t,e){if("object"!==(0,r.Z)(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var a=n.call(t,e||"default");if("object"!==(0,r.Z)(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===(0,r.Z)(e)?e:String(e)}},71002:function(t,e,n){function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}n.d(e,{Z:function(){return r}})},40181:function(t,e,n){n.d(e,{Z:function(){return a}});var r=n(30907);function a(t,e){if(t){if("string"===typeof t)return(0,r.Z)(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?(0,r.Z)(t,e):void 0}}}}]);
//# sourceMappingURL=src_RtspCamera_jsx-node_modules_babel_runtime_helpers_esm_assertThisInitialized_js-node_modul-c85988.8f1408af.chunk.js.map